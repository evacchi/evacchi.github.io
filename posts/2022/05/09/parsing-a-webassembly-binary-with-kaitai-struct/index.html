<!doctype html><html lang=en-us><head><title>Parsing A WebAssembly Binary With Kaitai Struct | Middle of Nowhere</title><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Traditionally Java libraries come with everything but the kitchen sink. In the past, people have given a lot of crap to the JavaScript ecosystem, but if there is something I envy, is how tiny some libraries are. People are still joking about left-pad to this day; in reality, the JavaScript ecosystem has come a long way ever since, and I believe we have all something to learn.
Long story short, I was looking for a Java library to parse WebAssembly binaries, and what I found was either a full-blown interpreter or something outdated. Then I remembered about Kaitai Struct, a parser generator for binary structures that supports a number of languages. I have read great things, but I never had a reason to try it personally; until now."><meta name=generator content="Hugo 0.147.8"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-JEBNMYFPPB"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JEBNMYFPPB")</script></head><body><nav class=navigation><a href=/><span class=arrow>←</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a></nav><main class=main><section id=single><h1 class=title>Parsing A WebAssembly Binary With Kaitai Struct</h1><div class=tip><time datetime="2022-05-09 00:00:00 +0000 UTC">May 9, 2022</time>
<span class=split>·
</span><span>305 words
</span><span class=split>·
</span><span>2 minute read</span></div><div class=content><p>Traditionally Java libraries come with everything but the kitchen sink. In the past, people have given a lot of crap to the JavaScript ecosystem, but if there is something I envy, is how tiny some libraries are. People are still joking about <a href=https://qz.com/646467/how-one-programmer-broke-the-internet-by-deleting-a-tiny-piece-of-code/ target=_blank rel=noopener>left-pad</a> to this day; in reality, the JavaScript ecosystem has come a long way ever since, and I believe we have all something to learn.</p><p>Long story short, I was looking for a Java library to parse <a href=https://webassembly.github.io/spec/core/binary/index.html target=_blank rel=noopener>WebAssembly binaries</a>, and what I found was either a full-blown interpreter or something outdated. Then I remembered about <a href=https://kaitai.io target=_blank rel=noopener>Kaitai Struct</a>, a parser generator for binary structures that supports a number of languages. I have read great things, but I never had a reason to try it personally; until <em>now</em>.</p><p><p class=markdown-image><img src=/assets/kaitai/kaitai-home.png alt="Kaitai Home"></p></p><p><a href=https://kaitai.io target=_blank rel=noopener>Kaitai Struct</a> comes with <a href=https://formats.kaitai.io target=_blank rel=noopener>a rich library of supported binary formats</a>. Because it is a parser generator with multiple language backends, by writing one good grammar you will get support for all those languages for &ldquo;free&rdquo;. If a <code>wasm</code> grammar was there, my search would have ended. Unfortunately, WebAssembly <a href=https://github.com/kaitai-io/kaitai_struct_formats/issues/158 target=_blank rel=noopener>is not present officially</a>.</p><p>But nothing was lost: <a href=https://github.com/sophoslabs/WebAssembly target=_blank rel=noopener>there is a Sophos Labs repository</a> with a <a href=https://github.com/sophoslabs/WebAssembly/tree/master/Tools/Kaitai-Wasm target=_blank rel=noopener>fairly complete Kaitai grammar for Wasm binaries</a>. This grammar is working in most cases except it does not support <a href=https://webassembly.github.io/spec/core/binary/modules.html#data-count-section target=_blank rel=noopener>Data Count Sections</a> and it does not parse <a href=https://webassembly.github.io/spec/core/binary/modules.html#binary-customsec target=_blank rel=noopener>Custom Sections</a> correctly.</p><p>Custom sections are in fact fairly important for compilers. For instance, <a href=https://github.com/WebAssembly/tool-conventions/blob/main/Linking.md target=_blank rel=noopener>LLVM&rsquo;s WebAssembly backend stores extra metadata in a <code>linking</code> custom section</a>. When such a section is present, the <code>wasm</code> file is an object file, and it is not expected to be directly executable. So, I decided to <a href=https://github.com/sophoslabs/WebAssembly/pull/4 target=_blank rel=noopener>fix the grammar myself</a>; this is when I learned that <a href=https://ide.kaitai.io target=_blank rel=noopener>Kaitai comes with a fantastic Web-based IDE</a>, complete with a live preview of the parse-tree and an hex-editor that syncs with the parse tree!</p><video controls width=100%>
<source src=/assets/kaitai/kaitai-sync.webm type=video/webm><img src /assets/kaitai/kaitai-ide.png" alt="Kaitai IDE"></video><p>That is pretty cool! I have <a href=https://github.com/sophoslabs/WebAssembly/pull/4 target=_blank rel=noopener>opened a PR to the original repository</a> to fix the initial issues I found, but I am working on extending the grammar to add some support to the <a href=https://github.com/WebAssembly/tool-conventions/blob/main/Linking.md target=_blank rel=noopener>custom <code>linking</code> section</a>. Hopefully, this will make it easier to support reading a <code>wasm</code> file from multiple languages, without having to go through the entire spec every time.</p></div><div class=tags><a href=/tags/wasm>wasm</a>
<a href=/tags/parser>parser</a>
<a href=/tags/kaitai>kaitai</a></div></section></main><footer id=footer><div class=social><a class="symbol bluesky" href=https://bsky.app/profile/evacchi.dev rel=me target=_blank></a><a class="symbol github" href=https://github.com/evacchi rel=me target=_blank></a><a class="symbol linkedin" href=https://linkedin.com/in/edoardovacchi rel=me target=_blank></a><a class="symbol mastodon" href=https://mastodon.social/@evacchi rel=me target=_blank></a><a class="symbol twitter" href=https://twitter.com/evacchi rel=me target=_blank></a></div><div class=copyright>© Copyright
2025
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg>
</span>Edoardo Vacchi</div><div class=powerby>Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://github.com/nodejh/hugo-theme-mini>nodejh</a></div></footer></body></html>